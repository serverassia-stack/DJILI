@echo off
chcp 65001 >nul
title بناء مدير الاشتراكات المتقدم

echo.
echo ========================================
echo    🚀 بناء مدير الاشتراكات المتقدم
echo ========================================
echo.

:: التحقق من تثبيت Python
python --version >nul 2>&1
if errorlevel 1 (
    echo ❌ Python غير مثبت على النظام!
    echo يرجى تثبيت Python 3.6 أو أعلى من:
    echo https://www.python.org/downloads/
    pause
    exit /b 1
)

:: التحقق من تثبيت PyInstaller
python -c "import pyinstaller" 2>nul
if errorlevel 1 (
    echo 📦 تثبيت PyInstaller...
    pip install pyinstaller
    if errorlevel 1 (
        echo ❌ فشل تثبيت PyInstaller!
        pause
        exit /b 1
    )
)

:: إنشاء مجلد البناء
if not exist "build" mkdir build
if not exist "dist" mkdir dist

echo.
echo 🔨 بدء بناء التطبيق...
echo.

:: بناء التطبيق
pyinstaller --onefile --windowed --name "مدير الاشتراكات" --icon=app_icon.ico main.py

if errorlevel 1 (
    echo.
    echo ❌ فشل بناء التطبيق!
    echo يرجى التحقق من الأخطاء أعلاه.
    pause
    exit /b 1
)

:: نسخ الملفات الضرورية
echo.
echo 📁 نسخ الملفات المساعدة...
xcopy *.json dist\ /Y >nul 2>&1
xcopy *.md dist\ /Y >nul 2>&1
xcopy *.txt dist\ /Y >nul 2>&1

:: إنشاء ملف تشغيل إضافي
echo @echo off > dist\تشغيل.bat
echo chcp 65001 >nul >> dist\تشغيل.bat
echo title مدير الاشتراكات المتقدم >> dist\تشغيل.bat
echo echo. >> dist\تشغيل.bat
echo echo ======================================== >> dist\تشغيل.bat
echo echo    🚀 مدير الاشتراكات المتقدم >> dist\تشغيل.bat
echo echo ======================================== >> dist\تشغيل.bat
echo echo. >> dist\تشغيل.bat
echo start مدير الاشتراكات.exe >> dist\تشغيل.bat
echo exit >> dist\تشغيل.bat

echo.
echo ========================================
echo    ✅ تم البناء بنجاح!
echo ========================================
echo.
echo 📂 الملفات الموجودة في مجلد 'dist':
echo    - مدير الاشتراكات.exe      (التطبيق الرئيسي)
echo    - تشغيل.bat               (ملف تشغيل بديل)
echo    - *.json                  (ملفات الإعدادات)
echo    - README.md               (دليل الاستخدام)
echo.
echo 🚀 يمكنك الآن تشغيل "مدير الاشتراكات.exe"
echo.
echo ⚠️  ملاحظات:
echo    - التطبيق لا يحتاج تثبيت، شغّل الملف مباشرة
echo    - البيانات تحفظ تلقائياً في مجلد المستخدم
echo    - يدعم التطبيق Windows 7/8/10/11
echo.

pause
